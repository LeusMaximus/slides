# Новелла о прагматичном тестировании

- выступление: начало июня
- пруфы из жизни

Вы можете [открыть в интерфейсе проведения презентаций](https://nin-jin.github.io/slides/testing/)

# О себе

- Программирую с 10 лет
- Пилил большие и маленькие сервисы
- В основном фронт, но не только
- Разработал фреймворк, опередивший время
- Сейчас разрабатываю крутую штуку для 1С

# Путь в тестировании

- Не писал тесты
- Избегал тесты
- Без тестировщиков пришлось разбираться самому
- Понял как правильно тестировать

# Цель

- Поделиться свежим взглядом на процесс тестирования

# Будни разработчика

- Баги
- Деньги
- Сроки
- Менеджеры

# Борьба с багами

- Пиши без багов! (с) Наивный Тимлид
- Поднять отряд ручных тестировщиц! (c) Типичный Менеджер
- Опишем всё типами! (с) Читатель Хабра
- Кажется нам нужны тесты.. (с) Безысходность

# Виды контрактов

- **На словах** - не формальный контракт, никто не проверит
- **На типах** - сложно выразить необходимое
- **На примерах** - это и есть тесты

# Нелюбовь к тестам

- Долго писать
- Сложно писать
- Всё время ломаются
- Бесполезны

## Долго писать

- Медленный запуск
- Много кода
- Много кейсов
- Сложно писать

## Сложно писать

- Нетестируемая архитектура
- Ограниченный тестовый фреймворк

## Всё время ломаются

- Меняются требования
- Меняется понимание требований
- Фиксируется неважное поведение

## Бесполезные тесты

- Проверяют не важное поведение
- Не проверяют важное поведение
- Тавтологические тесты
- Недостаточный охват

## Недостаточный охват

- Разработчики не умеют в тестирование
- Вредные практики (TDD, GWT)
- Лень

# Зачем? Обнаружение дефектов как можно раньше!

> *Жизненный цикл фичи: dev -> review -> qa -> uat -> prod*
> *Чем раньше поставить тесты, чем короче цикл отладки.*

# Зачем? Локализация дефектов!

> *Тест указывает на конкретное проблемное место в коде.*

# Зачем? Ускорение разработки!

> *Тест в любом случае придётся написать.*
> *Но перезапускать его быстрее, чем проверять руками.*

# Зачем? Актуальная документация!

> *Отдельная документация всегда врёт.*
> *Даже если это комментарий рядом с кодом.*

# Идеальные тесты

- Проверяют всё важное
- Не фиксируют неважное
- Минимальное число
- Охватывают все кейсы
- Исполняются быстро
- Писать просто

# Объект тестирования: система (приложение)

Система - едница развёртывания.

![Система](https://habrastorage.org/webt/2l/pj/7z/2lpj7ziss3wkfogjqpp_7y8oo5u.png)

# Объект тестирования: модуль (юнит)

Модуль - единица кода.

![Модули](https://habrastorage.org/webt/uh/hy/zr/uhhyzrwxalg0nrbwcbaien4qa_y.png)

# Объект тестирования: компонент (подсистема)

Компонент - единица функциональности.

![Компоненты](https://habrastorage.org/webt/rh/wf/hm/rhwfhmamtnvyhx8bmiaukpq_spw.png)

# Игра про объекты

*Какая-то игра на усвоение различия компонента от модуля*

# Тип теста: функциональный

> *Чёрный ящик.*
> *Пример: тыкнули палочкой - он сказал "ой".*

# Тип теста: интеграционный

> *Соединённая группа чёрных ящиков.*
> *Пример: парсер + сериализатор.*

# Тип теста: нагрузочный

> *Маленький чёрный ящик боится в окружении танков.*
> *Пример: 1000 раз тыкнули палочкой и замерили время последнего "ой".*

# Вид процесса тестирования: приёмочный

> *Выбраковка на конвеере.*

# Вид процесса тестирования: регрессионный

> *Тут поправил - там поехало.*

# Вид процесса тестирования: дымовой

> *Просто Дженга.*

# Вид процесса тестирования: полный

> *Детальные замеры болта.*

# Вид процесса тестирования: конфигурационный

> *~~Секс~~ Программирование в разных местах.*

# Классификация тестирования

| Процесс | Тип | Объект |
|---------|-----|--------|
| Приёмочная проверка.. | ..функциональности.. | ..модуля. |
| Регрессионная проверка.. | ..интеграции.. | ..компонента. |
| Дымовая проверка.. | ..производительности.. | ..системы. |
| Полная проверка.. | | |

# Когда тесты лишние

- Когда требования не ясны
- Когда дохода дают меньше, чем расходов

Переписывать код - обидно. Переписывать тесты - обидно вдвойне.

# Тестирование в большинстве компаний

1. Разработчики пишут модульные тесты.
2. Приёмочное/регрессионное ручное тестирование при релизе.
3. Автотестеры с сильной задержкой пишут системные тесты.

# Модульные тесты ломают инкапсуляцию

> *Модуль А зависит от модуля Б.*
> *Зависимость от Б выносится в публичный интерфейс.*
> *Часто это знание навязывается через конструктор.*
> *Инкапсуляция не про сокрытие внутренних полей, а про незнание внутренних особенностей.*

# Модульные тесты - хрупкие

> *Модуль А зависит от модуля Б.*
> *Изменили протокол их взаимодействия, не меняя внешнего поведения А.*
> *Сломались тесты А и Б.*

# Модульные тесты не полны

> *Чем меньше и проще модули, тем более важно их взаимодействие.*

![Тестирование взаимодействия](https://habrastorage.org/webt/pe/gg/7x/pegg7xxyyeggnufdsh3gixdzfhm.png)

# Интеграционные тесты не полны

> *То, что они могут взаимодействовать правильно, не значит, что оно так и есть в конечном приложении.*

> 1 + ( 2 * 3 ) = 7
> ( 1 + 2 ) * 3 = 9

# Системные тесты не масштабируются

> *Тестрование самолёта в сборе, чтобы проверить, что шуруп подходит к гайке.*

> ( b * b ) + ( -4 * a * c )

# Правда про интеграционные тесты

1. Их никто на самом деле не пишет.
2. А те, кто пишет, пишет на самом деле компонентные.

# Компонентные тесты

1. Медленные (TestBed в ангуляре давал 100мс на тест)
2. Не локализуют проблему (часто запускаются в поизвольном порядке)
3. Невозможны в монолитной архитектуре

# Рожок тестирования

![Пирамида и рожок тестирования](https://habrastorage.org/webt/ep/iv/4k/epiv4k-gp9lfbunqemk8yom2qu4.png)

Хватит вращать рожок тестирования, его нужно просто выбросить.

# Фрактальные тесты

> *Компонентных тестов столько же сколько модульных*
> *писать их проще чем модульные*
> *исполняются они быстрее чем системные*
> *а покрытие дают сравнимое с системным*

# Резюме

- Разработчики не умеют в тестирование и это надо исправлять
- Фиксировать надо важное поведение
- А невавжное фиксировать не надо
- Тесты нужны самому же разаботчику
- Модульные тесты бессмысленны
- Фрактальные тесты наиболее практичны
